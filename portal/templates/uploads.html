{% extends "base.html" %}
{% block title %}Uploads{% endblock %}
{% block content %}

<h1 class="mb-3">Uploads</h1>

<div class="mb-3 flex flex-wrap gap-2">
  {# Removed duplicates to top nav: Imports and Recycle Bin #}
  <form method="post" action="{{ url_for('artifacts_sweep') }}" style="display:inline;">
    <button type="submit" class="btn btn-primary">Artifact Sweep</button>
  </form>
</div>

{% if files|length == 0 %}
  <p>No files in <code>/uploads</code>.</p>
{% else %}
<form method="post" action="{{ url_for('uploads_delete') }}">
  <div class="mb-2 flex items-center gap-2">
    <button type="submit" class="btn btn-danger">Delete Selected (to Recycle Bin)</button>
    {# Removed duplicate "Open Recycle Bin" link here #}
    <span class="muted ml-auto">{{ files|length }} file{{ '' if files|length == 1 else 's' }}</span>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th style="width:44px;"><input type="checkbox" id="checkAll" onclick="toggleAll(this)"></th>
        <th>Filename</th>
        <th>Size</th>
        <th>Modified</th>
        <th>Preview</th>
      </tr>
    </thead>
    <tbody>
      {% for f in files %}
      <tr>
        <td><input type="checkbox" name="names" value="{{ f.name }}"></td>
        <td><code>{{ f.name }}</code></td>
        <td>{{ (f.size/1024)|round(1) }} KB</td>
        <td>{{ f.modified.strftime("%Y-%m-%d %H:%M:%S") }}</td>
        <td>
          {% if f.name.lower().endswith(('.png','.jpg','.jpeg')) %}
            <a href="{{ url_for('serve_upload', filename=f.name) }}" target="_blank" rel="noopener">Open</a>
          {% else %}
            <em class="muted">n/a</em>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</form>
{% endif %}

<script>
function toggleAll(box){
  const checks = document.querySelectorAll('input[name="names"]');
  checks.forEach(c => c.checked = box.checked);
}
</script>
{% endblock %}
