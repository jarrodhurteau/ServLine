<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}ServLine Portal{% endblock %}</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              bg: '#0b1220',
              panel: '#111a2f',
              ink: '#e8eefc',
              muted: '#9fb0d1',
              line: '#1f2a44',
              brand: { 50: '#eaf2ff', 500: '#7aa2ff', 600: '#5a86f7' }
            },
            boxShadow: { card: '0 8px 24px rgba(0,0,0,.25)' },
            borderRadius: { xl: '14px' }
          }
        }
      }
    </script>

    <!-- Custom global stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">

    <style>
      :root { --bg:#0b1220; --panel:#111a2f; --ink:#e8eefc; --muted:#9fb0d1; --line:#1f2a44; }
      * { box-sizing: border-box; }
      html,body { height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink); }
      a { color:#b7cdfb; text-decoration:none; }
      a:hover { text-decoration:underline; }

      .nav { display:flex; gap:16px; align-items:center; padding:14px 18px; border-bottom:1px solid var(--line); background:#0d162b; position:sticky; top:0; z-index:50; }
      .brand { font-weight:700; letter-spacing:.3px; }
      .wrap { max-width:960px; margin:24px auto; padding:0 16px; }
      .card { background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,.25); }
      .crumbs { color:var(--muted); margin:0 0 10px; font-size:14px; }
      h1,h2 { margin:0 0 10px; }
      .muted { color:var(--muted); }
      .ml-auto { margin-left: auto; }

      /* ----------- Day 19: No-truncate / wrapping helpers ----------- */
      .text-wrap { white-space:normal; overflow-wrap:anywhere; word-break:normal; }
      .break-anywhere { overflow-wrap:anywhere; word-break:break-word; }
      .prewrap { white-space:pre-wrap; }

      /* ------------------------------------------------------------------
         Buttons: PRIMARY BLUE IS THE DEFAULT. Black text per design.
         Use .btn-danger for red, .btn-ghost for neutral.
         ------------------------------------------------------------------ */
      .btn {
        display:inline-block;
        font-weight:600;
        padding:0.45rem 1rem;
        border-radius:0.75rem;
        border:1px solid #7aa2ff;
        background:#7aa2ff;      /* default = primary blue */
        color:#000;               /* black lettering */
        transition:background .2s, color .2s, border-color .2s, opacity .2s;
        text-decoration:none;
        cursor:pointer;
      }
      .btn:hover { background:#5a86f7; border-color:#5a86f7; color:#000; }
      .btn:disabled { opacity:.6; cursor:not-allowed; }

      /* Optional explicit variants (still primary by default) */
      .btn-primary { background:#7aa2ff; border-color:#7aa2ff; color:#000; }
      .btn-primary:hover { background:#5a86f7; border-color:#5a86f7; color:#000; }

      .btn-ghost  { background:#fff; border-color:var(--line); color:#111827; }
      .btn-ghost:hover { background:#f9fafb; color:#111827; }

      .btn-danger { background:#b91c1c; border-color:#b91c1c; color:#000; }
      .btn-danger:hover { background:#991b1b; border-color:#991b1b; color:#000; }

      /* Small button */
      .btn-sm { padding:0.3rem 0.75rem; font-size:0.875rem; line-height:1.2; }

      /* Tables */
      table.table { width:100%; border-collapse: collapse; }
      .table th, .table td { padding: 10px 12px; border-bottom: 1px dashed var(--line); vertical-align: top; }
      .table th { text-align: left; color: var(--muted); font-weight: 600; }

      /* Inputs: force light controls with black text for readability */
      select.form-select,
      input.form-control,
      textarea.form-control,
      select,
      input[type="text"],
      input[type="number"],
      input[type="email"],
      input[type="password"],
      textarea {
        color:#000 !important;
        background:#fff !important;
      }
      select.form-select option,
      select option {
        color:#000 !important;
        background:#fff !important;
      }
      input::placeholder, textarea::placeholder { color:#666; opacity:1; }

      /* Day 19: Auto-resizing textareas (JS sets height). */
      textarea.form-control,
      textarea.js-autosize,
      textarea[data-autosize] {
        overflow:hidden;           /* hide scrollbar while we auto-size */
        resize:none;               /* keep UX clean; JS handles height */
        line-height:1.3;
        min-height:2.25rem;        /* comfy default */
        max-height:60vh;           /* safety cap */
        white-space:pre-wrap;      /* show full text, keep line breaks */
        word-break:normal;
      }

      /* Day 19: Category chips (color set by --h; safe default provided). */
      .chip {
        --h: 210; /* default hue if not provided */
        display:inline-flex; align-items:center; gap:6px;
        padding:4px 10px; border-radius:999px;
        border:1px solid hsl(var(--h) 60% 50% / .35);
        background: hsl(var(--h) 60% 55% / .18);
        color:#e8eefc; font-weight:600; font-size:12.5px;
        white-space:nowrap;
      }
      .chip .dot {
        width:8px; height:8px; border-radius:999px;
        background:hsl(var(--h) 70% 60%);
        box-shadow:0 0 0 2px hsl(var(--h) 60% 50% / .25) inset;
      }

      /* Flash (optional subtle transition hook) */
      .flash-enter { opacity:0; transform:translateY(-4px); }
      .flash-enter-active { opacity:1; transform:translateY(0); transition:all .25s ease; }
    </style>

    <!-- IMPORTANT: Load app.css AFTER inline <style> so it can override -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}?v=2">

    {% block head %}{% endblock %}
  </head>
  <body class="bg-bg text-ink">
    <!-- Top Nav -->
    <div class="nav">
      <div class="brand"><a href="/">ServLine Portal</a></div>

      <div><a href="/restaurants" class="hover:underline">Restaurants</a></div>

      {% if show_admin %}
        <div><a href="/import" class="hover:underline">Import</a></div>
        <div><a href="/imports" class="hover:underline">Imports</a></div>
        <div><a href="/uploads" class="hover:underline">Uploads</a></div>
        <div><a href="/uploads/trash" class="hover:underline">Recycle Bin</a></div>
      {% endif %}

      <!-- Right-aligned auth controls -->
      <div class="ml-auto">
        {% if session.get('user') %}
          <form method="post" action="/logout" style="display:inline">
            <button class="btn btn-sm">Logout</button>
          </form>
        {% else %}
          <a href="/login" class="btn">Login</a>
        {% endif %}
      </div>
    </div>

    <!-- Flash messages -->
    <div class="wrap" aria-live="polite" aria-atomic="true">
      {% with msgs = get_flashed_messages(with_categories=true) %}
        {% if msgs %}
          <div class="space-y-2">
            {% for cat, msg in msgs %}
              <div class="rounded-xl border border-line bg-panel px-4 py-3 shadow-card
                          {% if cat == 'success' %} ring-1 ring-green-500/40 {% elif cat == 'error' %} ring-1 ring-red-500/40 {% else %} ring-1 ring-brand-500/30 {% endif %}">
                {{ msg }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
    </div>

    <!-- Main content -->
    <main class="wrap">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="wrap mt-10 mb-6 text-sm text-muted">
      <div class="border-t border-line pt-4">
        ServLine Portal Â· {{ now|default('') }}
      </div>
    </footer>

    <!-- Day 19: tiny helper for auto-resizing textareas -->
    <script>
      (function () {
        function autosize(el) {
          if (!el) return;
          el.style.height = 'auto';
          el.style.height = (el.scrollHeight) + 'px';
        }
        function wireOne(el) {
          autosize(el);
          el.addEventListener('input', () => autosize(el), { passive: true });
        }
        function init() {
          document.querySelectorAll('textarea[data-autosize], textarea.js-autosize').forEach(wireOne);
        }
        // Run on load
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }
        // Optional: watch for dynamically added textareas
        const mo = new MutationObserver(muts => {
          for (const m of muts) {
            m.addedNodes.forEach(n => {
              if (n.tagName === 'TEXTAREA' && (n.hasAttribute('data-autosize') || n.classList.contains('js-autosize'))) {
                wireOne(n);
              }
              if (n.querySelectorAll) {
                n.querySelectorAll('textarea[data-autosize], textarea.js-autosize').forEach(wireOne);
              }
            });
          }
        });
        mo.observe(document.documentElement, { childList: true, subtree: true });
      })();
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
